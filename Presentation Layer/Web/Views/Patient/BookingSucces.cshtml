
@{
    ViewData["Title"] = "BookingSucces";
    Layout = "~/Views/Shared/_LayoutPatient.cshtml";
}

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Breadcrumb Navigation -->
    <nav class="flex mb-8" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-4">
            <li>
                <div>
                    <a asp-controller="Dashboard" asp-action="Index" class="text-text-secondary hover:text-primary transition-smooth">
                        <svg class="flex-shrink-0 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
                        </svg>
                        <span class="sr-only">Inicio</span>
                    </a>
                </div>
            </li>
            <li>
                <div class="flex items-center">
                    <svg class="flex-shrink-0 h-5 w-5 text-text-secondary" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="ml-4 text-sm font-medium text-primary">Confirmar Cita</span>
                </div>
            </li>
        </ol>
    </nav>

    <!-- Progress Indicator -->
    <div class="mb-8">
        <div class="flex items-center justify-center">
            <div class="flex items-center space-x-4">
                <!-- Step 1: Specialty Selection (Completed) -->
                <div class="flex items-center">
                    <div class="progress-step completed">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <span class="ml-2 text-sm font-medium text-success">Especialidad</span>
                </div>

                <!-- Connector -->
                <div class="w-16 h-0.5 bg-success"></div>

                <!-- Step 2: Doctor Selection (Completed) -->
                <div class="flex items-center">
                    <div class="progress-step completed">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <span class="ml-2 text-sm font-medium text-success">Doctor</span>
                </div>

                <!-- Connector -->
                <div class="w-16 h-0.5 bg-success"></div>

                <!-- Step 3: Calendar (Completed) -->
                <div class="flex items-center">
                    <div class="progress-step completed">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <span class="ml-2 text-sm font-medium text-success">Fecha</span>
                </div>

                <!-- Connector -->
                <div class="w-16 h-0.5 bg-primary"></div>

                <!-- Step 4: Confirmation (Active) -->
                <div class="flex items-center">
                    <div class="progress-step active">
                        <span class="text-sm font-medium">4</span>
                    </div>
                    <span class="ml-2 text-sm font-medium text-primary">Confirmar</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Page Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-semibold text-text-primary mb-2">Confirmar Cita Médica</h1>
        <p class="text-text-secondary max-w-2xl mx-auto">Revisa los detalles de tu cita y confirma la reserva. Recibirás una notificación de confirmación y recordatorios automáticos.</p>
    </div>

    <!-- Main Content Grid -->
    <div class="max-w-4xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Appointment Summary Card -->
        <div class="lg:col-span-2">
            <div class="card">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-text-primary">Resumen de la Cita</h2>
                    <span class="text-sm text-text-secondary bg-secondary-100 px-3 py-1 rounded-full">
                        Ref: #MC-2025-001234
                    </span>
                </div>

                <!-- Doctor Information -->
                <div class="border border-secondary-200 rounded-lg p-6 mb-6">
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                            <img src="https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                                 alt="Dr. María González"
                                 class="w-16 h-16 rounded-lg object-cover"
                                 onerror="this.src='https://images.pexels.com/photos/5327585/pexels-photo-5327585.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2'; this.onerror=null;">
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-text-primary">Dra. María González</h3>
                            <p class="text-text-secondary mb-2">Especialista en Cardiología</p>
                            <div class="flex items-center space-x-4 text-sm text-text-secondary">
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                    </svg>
                                    +34 912 345 678
                                </div>
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    m.gonzalez@medicitas.es
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-1">
                            <svg class="w-4 h-4 text-warning" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                            <span class="text-sm font-medium text-text-secondary">4.9</span>
                        </div>
                    </div>
                </div>

                <!-- Appointment Details -->
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Date & Time -->
                        <div class="bg-primary-50 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <svg class="w-5 h-5 text-primary mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <h4 class="font-medium text-text-primary">Fecha y Hora</h4>
                            </div>
                            <p class="text-text-primary font-semibold">15/10/2025</p>
                            <p class="text-text-secondary">10:30 - 11:00</p>
                        </div>

                        <!-- Duration -->
                        <div class="bg-accent-50 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <svg class="w-5 h-5 text-accent mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <h4 class="font-medium text-text-primary">Duración</h4>
                            </div>
                            <p class="text-text-primary font-semibold">30 minutos</p>
                            <p class="text-text-secondary">Consulta estándar</p>
                        </div>
                    </div>

                    <!-- Location -->
                    <div class="bg-secondary-50 rounded-lg p-4">
                        <div class="flex items-center mb-2">
                            <svg class="w-5 h-5 text-secondary mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <h4 class="font-medium text-text-primary">Ubicación</h4>
                        </div>
                        <p class="text-text-primary font-semibold">Centro Médico MediCitas</p>
                        <p class="text-text-secondary">Calle Gran Vía, 45, 28013 Madrid</p>
                        <p class="text-text-secondary">Planta 3, Consulta 302</p>
                    </div>

                    <!-- Preparation Instructions -->
                    <div class="bg-warning-50 rounded-lg p-4">
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-warning mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div>
                                <h4 class="font-medium text-text-primary mb-2">Instrucciones de Preparación</h4>
                                <ul class="text-text-secondary text-sm space-y-1">
                                    <li>• Traer historial médico reciente y medicamentos actuales</li>
                                    <li>• Llegar 15 minutos antes de la cita</li>
                                    <li>• Traer documento de identidad y tarjeta sanitaria</li>
                                    <li>• Evitar cafeína 2 horas antes de la consulta</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Edit Links -->
                <div class="mt-6 pt-6 border-t border-secondary-200">
                    <h4 class="text-sm font-medium text-text-primary mb-3">¿Necesitas hacer cambios?</h4>
                    <div class="flex flex-wrap gap-3">
                        <a asp-controller="Appointment" asp-action="Specialty" class="text-sm text-primary hover:text-primary-700 transition-smooth flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"></path>
                            </svg>
                            Cambiar especialidad
                        </a>
                        <a asp-controller="Appointment" asp-action="Doctor" class="text-sm text-primary hover:text-primary-700 transition-smooth flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"></path>
                            </svg>
                            Cambiar doctor
                        </a>
                        <a asp-controller="Appointment" asp-action="Calendar" class="text-sm text-primary hover:text-primary-700 transition-smooth flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"></path>
                            </svg>
                            Cambiar fecha/hora
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirmation Sidebar -->
        <div class="lg:col-span-1">
            <div class="card sticky top-8">
                <h3 class="text-lg font-semibold text-text-primary mb-6">Confirmar Reserva</h3>

                <!-- Terms and Conditions -->
                <div class="mb-6">
                    <div class="bg-secondary-50 rounded-lg p-4 mb-4">
                        <h4 class="font-medium text-text-primary mb-2">Políticas Importantes</h4>
                        <ul class="text-sm text-text-secondary space-y-1">
                            <li>• Cancelación gratuita hasta 24h antes</li>
                            <li>• Reagendamiento sin costo adicional</li>
                            <li>• Política de privacidad RGPD</li>
                            <li>• Notificaciones automáticas activadas</li>
                        </ul>
                    </div>

                    <label class="flex items-start space-x-3 cursor-pointer">
                        <input type="checkbox" id="terms-checkbox" class="mt-1 w-4 h-4 text-primary border-secondary-300 rounded focus:ring-primary focus:ring-2">
                        <span class="text-sm text-text-secondary">
                            Acepto los
                            <a href="javascript:void(0)" class="text-primary hover:text-primary-700 transition-smooth">términos y condiciones</a>,
                            <a href="javascript:void(0)" class="text-primary hover:text-primary-700 transition-smooth">política de privacidad</a>
                            y las políticas de cancelación de MediCitas.
                        </span>
                    </label>
                </div>

                <!-- Notification Preferences -->
                <div class="mb-6">
                    <h4 class="font-medium text-text-primary mb-3">Recordatorios</h4>
                    <div class="space-y-3">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" checked class="w-4 h-4 text-primary border-secondary-300 rounded focus:ring-primary focus:ring-2">
                            <span class="text-sm text-text-secondary">Notificación 1 hora antes</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" checked class="w-4 h-4 text-primary border-secondary-300 rounded focus:ring-primary focus:ring-2">
                            <span class="text-sm text-text-secondary">Recordatorio 24 horas antes</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" class="w-4 h-4 text-primary border-secondary-300 rounded focus:ring-primary focus:ring-2">
                            <span class="text-sm text-text-secondary">SMS de confirmación</span>
                        </label>
                    </div>
                </div>

                <!-- Confirmation Button -->
                <button id="confirm-appointment-btn" class="w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed mb-4" disabled onclick="confirmAppointment()">
                    <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Confirmar Cita Médica
                </button>

                <!-- Security Notice -->
                <div class="text-center">
                    <div class="flex items-center justify-center text-xs text-text-secondary">
                        <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        Conexión segura SSL
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Success Modal -->
<div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-surface rounded-xl p-8 max-w-md mx-4 text-center">
        <div class="w-16 h-16 bg-success-50 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
        </div>
        <h3 class="text-xl font-semibold text-text-primary mb-2">¡Cita Confirmada!</h3>
        <p class="text-text-secondary mb-6">Tu cita ha sido reservada exitosamente. Recibirás una confirmación por email y recordatorios automáticos.</p>
        <div class="bg-secondary-50 rounded-lg p-4 mb-6">
            <p class="text-sm font-medium text-text-primary">Número de Referencia</p>
            <p class="text-lg font-semibold text-primary">#MC-2025-001234</p>
        </div>
        <div class="flex space-x-3">
            <button onclick="goToAppointmentDetails()" class="flex-1 btn-primary">
                Ver Detalles
            </button>
            <button onclick="goToDashboard()" class="flex-1 btn-secondary">
                Ir al Dashboard
            </button>
        </div>
    </div>
</div>

<!-- Floating Chat Widget -->
<div class="fixed bottom-6 right-6 z-50">
    <button class="chat-widget w-14 h-14 flex items-center justify-center" onclick="toggleChat()">
        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
    </button>
</div>
<!-- JavaScript -->
<script>
    // Terms checkbox handler
    const termsCheckbox = document.getElementById('terms-checkbox');
    const confirmButton = document.getElementById('confirm-appointment-btn');

    termsCheckbox.addEventListener('change', function() {
        confirmButton.disabled = !this.checked;
    });

    // Confirm appointment function
    function confirmAppointment() {
        // Show loading state
        confirmButton.innerHTML = `
            <svg class="animate-spin w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Confirmando...
        `;
        confirmButton.disabled = true;

        // Simulate API call
        setTimeout(() => {
            // Store appointment data
            const appointmentData = {
                id: 'MC-2025-001234',
                specialty: 'Cardiología',
                doctor: 'Dra. María González',
                date: '15/10/2025',
                time: '10:30',
                status: 'Pending',
                location: 'Centro Médico MediCitas',
                address: 'Calle Gran Vía, 45, 28013 Madrid',
                room: 'Planta 3, Consulta 302',
                duration: '30 minutos',
                confirmedAt: new Date().toISOString()
            };

            // Store in localStorage
            localStorage.setItem('latestAppointment', JSON.stringify(appointmentData));

            // Add to appointments list
            let appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
            appointments.unshift(appointmentData);
            localStorage.setItem('appointments', JSON.stringify(appointments));

            // Show success modal
            document.getElementById('success-modal').classList.remove('hidden');

            // Setup notification reminder (simulate)
            setupAppointmentReminder(appointmentData);
        }, 2000);
    }

    // Setup appointment reminder
    function setupAppointmentReminder(appointment) {
        // In a real app, this would setup push notifications
        console.log('Setting up reminder for appointment:', appointment.id);

        // Store reminder preference
        localStorage.setItem('reminderEnabled', 'true');
        localStorage.setItem('nextReminder', appointment.date + ' ' + appointment.time);
    }

    // Modal navigation functions
    function goToAppointmentDetails() {
        window.location.href = 'appointment_details.html';
    }

    function goToDashboard() {
        window.location.href = 'dashboard.html';
    }

    // Chat widget toggle
    function toggleChat() {
        alert('Chat de ayuda - Funcionalidad próximamente disponible');
    }

    // Load appointment data from previous steps
    window.addEventListener('DOMContentLoaded', function() {
        // In a real app, this would load from the booking flow
        const selectedSpecialty = localStorage.getItem('selectedSpecialtyName') || 'Cardiología';
        const selectedDoctor = localStorage.getItem('selectedDoctorName') || 'Dra. María González';
        const selectedDate = localStorage.getItem('selectedDate') || '15/10/2025';
        const selectedTime = localStorage.getItem('selectedTime') || '10:30';

        // Update UI with selected data (if needed)
        console.log('Loaded appointment data:', {
            specialty: selectedSpecialty,
            doctor: selectedDoctor,
            date: selectedDate,
            time: selectedTime
        });
    });

    // Close modal when clicking outside
    document.getElementById('success-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            this.classList.add('hidden');
        }
    });
</script>

