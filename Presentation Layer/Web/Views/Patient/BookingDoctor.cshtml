@model List<Web.Models.DTO.DoctorCard>

@using Web.Models.DTO
@{
    ViewData["Title"] = "Seleccionar Doctor";
    Layout = "~/Views/Shared/_LayoutPatient.cshtml";

    var specialtyId = (int?)ViewBag.IdSpecialty ?? 0;
    var specialtyName = (Model != null && Model.Any() && Model.First().speciality != null)
        ? Model.First().speciality.NameSpecialty
        : "la especialidad seleccionada";
}

<style>
    /* Estilos de Pasos e Inputs (Mantener) */
    :root {
        --primary-color: #3b82f6;
        --success-color: #10b981;
        --secondary-200: #e5e7eb;
        --secondary-400: #9ca3af;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --surface: #ffffff;
    }

    /* Clases de utilidad para el Step Indicator */
    .progress-step {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--secondary-200);
        color: var(--secondary-400);
        transition: all 0.3s;
    }

        .progress-step.active {
            background-color: var(--primary-color);
            color: white;
        }

        .progress-step.completed {
            background-color: var(--success-color);
            color: white;
        }

    /* Clases de utilidad para Inputs y Cards */
    .input-focus {
        padding: 0.75rem 1rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        transition: all 0.3s;
    }

        .input-focus:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

    .transition-smooth {
        transition: all 0.3s ease;
    }

    .hover\:shadow-floating:hover {
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .card {
        background: var(--surface);
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        transition: all 0.3s;
        border: 2px solid transparent;
    }

        .card.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }

    .btn-primary {
        background-color: var(--primary-color);
        color: white;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: background-color 0.2s;
    }

        .btn-primary:hover {
            background-color: #2563eb; /* Un tono más oscuro */
        }

    .bg-accent-50 {
        background-color: #eff6ff;
    }

    .text-accent {
        color: #3b82f6;
    }

    .text-success {
        color: var(--success-color);
    }

    /* ESTILO PARA FOTO DE DOCTOR POR DEFECTO */
    .doctor-icon-placeholder {
        background-color: #e5e7eb; /* Gris claro */
        color: #9ca3af; /* Gris oscuro para el ícono */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #availability-filter option {
        padding: 4px 8px; /* Ejemplo */
        border-radius: 9999px; /* Ejemplo */
    }
</style>

<input type="hidden" id="selected-specialty-id" value="@specialtyId" data-id="@specialtyId" />

<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <nav class="flex mb-8" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-4">
            <li><a asp-controller="Patient" asp-action="Index" class="text-text-secondary hover:text-primary transition-smooth">🏠</a></li>
            <li>
                <div class="flex items-center">
                    <svg class="flex-shrink-0 h-5 w-5 text-text-secondary" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
                    <a asp-controller="Patient" asp-action="Booking" class="ml-4 text-sm font-medium text-text-secondary hover:text-primary transition-smooth">Especialidad</a>
                </div>
            </li>
            <li>
                <div class="flex items-center">
                    <svg class="flex-shrink-0 h-5 w-5 text-text-secondary" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
                    <span class="ml-4 text-sm font-medium text-primary">Seleccionar Doctor</span>
                </div>
            </li>
        </ol>
    </nav>

    <div class="text-center mb-8">
        <h1 class="text-3xl font-semibold text-text-primary mb-2">Seleccionar Doctor</h1>
        <p class="text-text-secondary max-w-2xl mx-auto" id="specialty-description">
            Elige el doctor de <strong>@specialtyName</strong> de tu preferencia para tu consulta. Todos nuestros especialistas están altamente calificados.
        </p>
    </div>

    <div class="mb-8">
        <div class="bg-surface rounded-xl p-6 shadow-soft border border-secondary-200">
            <div class="mb-6">
                <div class="relative w-full">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-text-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <input type="text" id="doctor-search" class="input-focus w-full pl-10 pr-4" placeholder="Buscar doctor por nombre...">
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-3 gap-8">
                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Disponibilidad</label>
                    <select id="availability-filter" class="input-focus w-full tag-filter">
                        <option value="all">Todos</option>
                        <option value="today">Hoy</option>
                        <option value="tomorrow">Mañana</option>
                        <option value="week">Esta semana</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Experiencia</label>
                    <select id="experience-filter" class="input-focus w-full">
                        <option value="all">Todos</option>
                        <option value="15+">15+ años</option>
                        <option value="10+">10+ años</option>
                        <option value="5+">5+ años</option>
                        <option value="1+">1+ años</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Idiomas</label>
                    <select id="language-filter" class="input-focus w-full">
                        <option value="all">Todos</option>
                        <option value="español">Español</option>
                        <option value="inglés">Inglés</option>
                        <option value="portugués">Portugués</option>
                        <option value="italiano">Italiano</option>
                        <option value="alemán">Alemán</option>
                    </select>
                </div>

                <div></div>
            </div>

            <div class="mt-4 flex justify-end">
                <button id="reset-filters" class="text-sm text-text-secondary hover:text-primary transition-smooth flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Limpiar filtros
                </button>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="doctors-grid">
        @if (Model != null && Model.Any())
        {
            foreach (var doctor in Model)
            {
                var availabilityList = new List<string>();
                if (doctor.AvailableToday > 0) availabilityList.Add("today");
                if (doctor.AvailableTomorrow > 0) availabilityList.Add("tomorrow");
                if (doctor.AvailableThisWeek > 0) availabilityList.Add("week");
                var availabilityData = string.Join(",", availabilityList);

                <div class="card hover:shadow-floating transition-smooth cursor-pointer doctor-card"
                     data-id="@doctor.idDoctor"
                     data-doctor="@doctor.fullNameDoc.ToLower()"
                     data-experience="@doctor.yearsExperience"
                     data-languages="@doctor.languagues.ToLower()"
                     data-availability="@availabilityData">

                    <div class="flex items-start space-x-4 mb-4">
                        <div class="w-16 h-16 rounded-full overflow-hidden doctor-icon-placeholder">
                            @if (!string.IsNullOrEmpty(doctor.imgProfile))
                            {
                                <img src="@doctor.imgProfile" alt="@doctor.fullNameDoc" class="w-full h-full object-cover" />
                            }
                            else
                            {
                                <svg class="w-8 h-8 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                                </svg>
                            }
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold">@doctor.fullNameDoc</h3>
                            <p class="text-sm text-text-secondary">@doctor.speciality.NameSpecialty</p>
                        </div>
                    </div>

                    <div class="text-sm text-gray-600 mb-4">
                        <p><strong>@doctor.yearsExperience</strong> años de experiencia</p>
                        <p>Idiomas: @doctor.languagues</p>
                        <p class="text-xs italic mt-2">@doctor.description</p>
                        <p class="text-sm text-gray-500 mt-1">📞 @doctor.phone</p>
                        <p class="text-sm text-gray-500">✉️ @doctor.email</p>
                    </div>

                    <div class="flex justify-between items-center">
                        <span class="text-xs px-2 py-1 rounded-full @(doctor.AvailableLabel != null ? "bg-green-100 text-green-600" : "bg-gray-200 text-gray-500")">
                            @(doctor.AvailableLabel ?? "Sin disponibilidad inmediata")
                        </span>
                        <button class="btn-primary text-sm px-4 py-2"
                                onclick="return selectDoctor(@doctor.idDoctor, '@doctor.fullNameDoc', arguments[0])">
                            Seleccionar
                        </button>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-span-full text-center py-12 text-gray-500">
                <p>No se encontraron doctores para esta especialidad.</p>
            </div>
        }
    </div>

    <div id="no-results" class="hidden text-center py-12">
        <p class="mt-1 text-sm text-text-secondary">No se encontraron doctores que coincidan con los filtros aplicados.</p>
    </div>
</main>

<script>
    window.bookingDoctorConfig = {
        specialtyId: @specialtyId,
        specialtyName: '@specialtyName',
        doctorsCount: @(Model?.Count ?? 0),
        baseUrl: '@Url.Content("~")'
    };
</script>

<script src="~/js/BookingDoctor.js" asp-append-version="true"></script>