@model Web.Models.ViewModels.DoctorVM.ProfileVM

@{
	// Mantiene la lógica de C# igual
	Layout = "~/Views/Shared/_LayoutDoctor.cshtml";
	ViewData["Title"] = "Mi Perfil";
	var user = Model?.User;
	var specialty = user?.DoctorSpecialties?.FirstOrDefault();
	var edad = DateTime.Today.Year - user.BirthDate.Year;
	if (user.BirthDate.Date > DateTime.Today.AddYears(-edad)) edad--;
	var initials = $"{user.FirstName[0]}{user.LastNamePat[0]}".ToUpper();
	string GetBadgeClass(string state) => state switch
	{
		"X" => "bg-danger",
		"N" => "bg-warning",
		"A" => "bg-success",
		"P" => "bg-info",
		_ => "bg-secondary"
	};

	string GetStateText(string state) => state switch
	{
		"X" => "Cancelada",
		"N" => "No asistió",
		"A" => "Asistió",
		"P" => "Pendiente",
		_ => "Desconocido"
	};
	var mainGradientStyle = "background: linear-gradient(to right, #2563eb, #06b6d4);";
}

@if (user == null)
{
	<div>No se encontró información del usuario.</div>
}
else
{
	<section class="position-relative pt-4 pb-3 px-3 overflow-hidden" style="background: linear-gradient(to right, #eff6ff, #ecfeff);">
		<div class="container position-relative">
			<div class="mx-auto">
				<h1 class="fw-bold h3 text-dark mb-2">Mi Perfil</h1>
				<p class="lead text-secondary mx-auto">
					Información esencial y visión general de la actividad como profesional de la salud.
				</p>
			</div>
		</div>
	</section>

	<div class="container py-5">
		<div class="card border-0 rounded-4 shadow-lg mb-5" style="background-color: #ffffff;">
			<div class="card-body p-4 p-md-5">
				<div class="row g-4 align-items-center">

					<div class="col-md-4 text-center border-md-end">
						<img src="https://ui-avatars.com/api/?name=@initials&background=0D8ABC&color=fff&size=180"
							 alt="Foto de perfil"
							 class="img-fluid rounded-circle shadow-lg mb-3"
							 style="width: 150px; height: 150px; object-fit: cover; border: 4px solid #06b6d4;">

						<h3 class="mt-3 mb-0 fw-bold text-dark">
							@(user.Gender == "F" ? "Dra." : "Dr.") @user.FirstName @user.LastNamePat
						</h3>
						<span class="badge text-white fw-bold" style="@mainGradientStyle">Activo</span>
						<div class="text-center mt-4">
							<button type="button" class="btn btn-lg fw-bold px-5 py-3 shadow"
									style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; border-radius: 0.75rem;"
									data-bs-toggle="modal" data-bs-target="#editProfileModal">
								<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" class="me-2">
									<path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
									<path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
								</svg>
								Editar Perfil
							</button>
						</div>
					</div>

					<div class="col-md-8">
						<h4 class="fw-bold text-dark mb-4">Detalles Personales y Profesionales</h4>
						<div class="row gy-3">
							<div class="col-sm-6">
								<label class="fw-semibold text-secondary small">Correo electrónico:</label>
								<p class="text-dark mb-0 fw-medium">@user.Email</p>
							</div>
							<div class="col-sm-6">
								<label class="fw-semibold text-secondary small">Documento de Identidad:</label>
								<p class="text-dark mb-0 fw-medium">@user.Document</p>
							</div>
							<div class="col-sm-6">
								<label class="fw-semibold text-secondary small">Teléfono:</label>
								<p class="text-dark mb-0 fw-medium">@user.Phone</p>
							</div>
							<div class="col-sm-6">
								<label class="fw-semibold text-secondary small">Género:</label>
								<p class="text-dark mb-0 fw-medium">@(user.Gender == "M" ? "Masculino" : "Femenino")</p>
							</div>
							<div class="col-sm-6">
								<label class="fw-semibold text-secondary small">Edad:</label>
								<p class="text-dark mb-0 fw-medium">@edad años</p>
							</div>
							<div class="col-sm-6">
								<label class="fw-semibold text-secondary small">Especialidad:</label>
								<p class="text-dark mb-0 fw-medium">@specialty?.Specialty.NameSpecialty</p>
							</div>
							<div class="col-sm-6">
								<label class="fw-semibold text-secondary small">Años de experiencia:</label>
								<p class="text-dark mb-0 fw-medium">@specialty?.YearsExperience años</p>
							</div>
							<div class="col-sm-6">
								<label class="fw-semibold text-secondary small">Fecha de Nacimiento:</label>
								<p class="text-dark mb-0 fw-medium">@user.BirthDate.ToString("dd/MM/yyyy")</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-xl modal-dialog-scrollable">
				<div class="modal-content border-0 shadow-lg" style="border-radius: 1rem;">
					<div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 1rem 1rem 0 0; padding: 1.5rem 2rem;">
						<h5 class="modal-title fw-bold d-flex align-items-center" id="editProfileModalLabel">
							<div class="bg-white bg-opacity-25 rounded-circle p-2 me-3">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
									<path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
									<path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
								</svg>
							</div>
							<span style="font-size: 1.25rem;">Editar Perfil</span>
						</h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>

					<div class="modal-body" style="padding: 2rem; background-color: #f8fafc;">
						<form id="editProfileForm" asp-action="UpdateProfileDoctor" asp-controller="Doctor" method="post" enctype="multipart/form-data">
							<input value="@user.IdUser" hidden name="IdUser" id="IdUser" />
							<!-- Cambiar Imagen de Perfil -->
							<div class="card border-0 shadow-sm mb-4" style="border-radius: 1rem; overflow: hidden;">
								<div class="card-header text-white border-0" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); padding: 1rem 1.5rem;">
									<h6 class="mb-0 fw-bold d-flex align-items-center">
										<div class="bg-white bg-opacity-25 rounded-circle p-1 me-2" style="width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">
											<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
												<path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z" />
												<path d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0z" />
											</svg>
										</div>
										Imagen de Perfil
									</h6>
								</div>
								<div class="card-body" style="padding: 1.5rem; background-color: white;">
									<div class="text-center mb-3">
										<img id="profileImagePreview" src="https://ui-avatars.com/api/?name=@initials&background=0D8ABC&color=fff&size=180"
											 alt="Preview"
											 class="img-fluid rounded-circle shadow mb-3"
											 style="width: 120px; height: 120px; object-fit: cover; border: 4px solid #8b5cf6;">
									</div>
									<div class="mb-3">
										<label for="profileImage" class="form-label fw-semibold text-dark">
											Subir nueva imagen
										</label>
										<input type="file" class="form-control shadow-sm border-0" id="profileImage" name="file" accept="image/*"
											   style="border-radius: 0.75rem; background-color: #f1f5f9; padding: 0.75rem;">
										<small class="text-muted">Formatos aceptados: JPG, PNG. Tamaño máximo: 2MB</small>
									</div>
								</div>
							</div>

							<!-- Cambiar Correo -->
							<div class="card border-0 shadow-sm mb-4" style="border-radius: 1rem; overflow: hidden;">
								<div class="card-header text-white border-0" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); padding: 1rem 1.5rem;">
									<h6 class="mb-0 fw-bold d-flex align-items-center">
										<div class="bg-white bg-opacity-25 rounded-circle p-1 me-2" style="width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">
											<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
												<path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z" />
											</svg>
										</div>
										Correo Electrónico
									</h6>
								</div>
								<div class="card-body" style="padding: 1.5rem; background-color: white;">
									<div class="mb-3">
										<label for="email" class="form-label fw-semibold text-dark">
											Nuevo correo electrónico
										</label>
										<input type="email" class="form-control shadow-sm border-0" id="email" name="Email"
											   value="@user.Email"
											   placeholder="ejemplo@correo.com"
											   style="border-radius: 0.75rem; background-color: #f1f5f9; padding: 0.75rem;">
									</div>
								</div>
							</div>

							<!-- Cambiar Contraseña -->
							<div class="card border-0 shadow-sm mb-4" style="border-radius: 1rem; overflow: hidden;">
								<div class="card-header text-white border-0" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 1rem 1.5rem;">
									<h6 class="mb-0 fw-bold d-flex align-items-center">
										<div class="bg-white bg-opacity-25 rounded-circle p-1 me-2" style="width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">
											<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
												<path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z" />
											</svg>
										</div>
										Contraseña
									</h6>
								</div>
								<div class="card-body" style="padding: 1.5rem; background-color: white;">
									<div class="mb-3">
										<label for="newPassword" class="form-label fw-semibold text-dark">
											Nueva contraseña
										</label>
										<input type="password" class="form-control shadow-sm border-0" id="newPassword" name="PasswordHash"
											   placeholder="Ingrese su nueva contraseña"
											   style="border-radius: 0.75rem; background-color: #f1f5f9; padding: 0.75rem;">
									</div>
									<div class="mb-3">
										<label for="confirmPassword" class="form-label fw-semibold text-dark">
											Confirmar nueva contraseña
										</label>
										<input type="password" class="form-control shadow-sm border-0" id="confirmPassword" name="PasswordHash"
											   placeholder="Confirme su nueva contraseña"
											   style="border-radius: 0.75rem; background-color: #f1f5f9; padding: 0.75rem;">
									</div>
									<small class="text-muted">Deje los campos vacíos si no desea cambiar la contraseña</small>
								</div>
							</div>

						</form>
					</div>

					<div class="modal-footer border-0" style="padding: 1.5rem 2rem; background-color: #f8fafc;">
						<button type="button" class="btn btn-light btn-lg px-4 shadow-sm fw-semibold" data-bs-dismiss="modal" style="border-radius: 0.75rem;">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
								<path d="M18 6 6 18"></path>
								<path d="m6 6 12 12"></path>
							</svg>
							Cancelar
						</button>
						<button type="button" class="btn btn-primary btn-lg px-5 shadow fw-bold" onclick="submitProfileForm()" style="border-radius: 0.75rem; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none;">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16" class="me-2">
								<path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z" />
							</svg>
							Guardar Cambios
						</button>
					</div>
				</div>
			</div>
		</div>
		<section class="card border-0 rounded-4 shadow-sm p-4">
			<h3 class="fw-bold mb-4 text-dark d-flex align-items-center">
				<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-3" viewBox="0 0 24 24">
					<rect width="18" height="18" x="3" y="4" rx="2" ry="2" />
					<path d="M16 2v4M8 2v4M3 10h18" />
				</svg>
				Historial de Citas
			</h3>

			<!-- Buscador de Pacientes -->
			<div class="d-flex justify-content-center mb-4">
				<form method="get" asp-action="Profile" asp-controller="Doctor" class="d-flex align-items-center" style="width: 100%; max-width: 500px;">
					<div class="position-relative flex-grow-1">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#64748b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
							 class="position-absolute top-50 translate-middle-y"
							 style="left: 1rem; z-index: 10;" aria-hidden="true">
							<circle cx="11" cy="11" r="8"></circle>
							<path d="m21 21-4.35-4.35"></path>
						</svg>
						<input type="text"
							   name="searchPatient"
							   value="@ViewBag.SearchPatient"
							   class="form-control ps-5 pe-3 border-2 shadow-sm"
							   placeholder="Buscar por nombre del paciente..."
							   aria-label="Buscar paciente"
							   style="height: 3rem; border-radius: 12px; border-color: #e2e8f0; transition: all 0.3s ease;"
							   onfocus="this.style.borderColor='#2563eb'; this.style.boxShadow='0 0 0 3px rgba(37, 99, 235, 0.1)'"
							   onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='0 1px 2px 0 rgba(0, 0, 0, 0.05)'">
					</div>

					<button type="submit"
							class="btn btn-primary ms-2 d-flex align-items-center justify-content-center shadow-sm"
							style="height: 3rem; width: 3rem; border-radius: 12px; background: linear-gradient(135deg, #2563eb, #1d4ed8); border: none; transition: all 0.3s ease;"
							onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 12px rgba(37, 99, 235, 0.4)'"
							onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 1px 2px 0 rgba(0, 0, 0, 0.05)'"
							title="Buscar">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="11" cy="11" r="8"></circle>
							<path d="m21 21-4.35-4.35"></path>
						</svg>
					</button>

					@if (!string.IsNullOrEmpty(ViewBag.SearchPatient as string))
					{
						<a href="@Url.Action("Profile", "Doctor")"
						   class="btn btn-outline-secondary ms-2 d-flex align-items-center justify-content-center shadow-sm"
						   style="height: 3rem; width: 3rem; border-radius: 12px; border: 2px solid #e2e8f0; transition: all 0.3s ease;"
						   onmouseover="this.style.backgroundColor='#fee2e2'; this.style.borderColor='#ef4444'; this.style.transform='scale(1.05)'"
						   onmouseout="this.style.backgroundColor='transparent'; this.style.borderColor='#e2e8f0'; this.style.transform='scale(1)'"
						   title="Limpiar búsqueda">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<path d="M18 6 6 18M6 6l12 12"></path>
							</svg>
						</a>
					}
				</form>
			</div>

			<!-- Mensaje de resultados de búsqueda -->
			@if (!string.IsNullOrEmpty(ViewBag.SearchPatient as string))
			{
				<div class="alert alert-info border-0 rounded-3 mb-4 d-flex align-items-center" style="background: linear-gradient(to right, #dbeafe, #e0f2fe);">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#2563eb" class="me-2" viewBox="0 0 16 16">
						<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
						<path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
					</svg>
					<span class="text-dark fw-medium">Mostrando resultados para: <strong>"@ViewBag.SearchPatient"</strong></span>
				</div>
			}

			<div class="table-responsive">
				<table class="table table-hover align-middle mb-0">
					<thead style="background: linear-gradient(to right, #f0f9ff, #f0fdfa);">
						<tr>
							<th class="fw-semibold text-dark py-3">Paciente</th>
							<th class="fw-semibold text-dark py-3">Fecha</th>
							<th class="fw-semibold text-dark py-3">Hora</th>
							<th class="fw-semibold text-dark py-3">Servicio</th>
							<th class="fw-semibold text-dark py-3">Estado</th>
							<th class="fw-semibold text-dark py-3">Comprobante</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var appt in Model.Appointments)
						{
							<tr class="border-bottom">
								<td class="text-dark fw-medium py-3">@appt.Patient.FirstName @appt.Patient.LastNamePat @appt.Patient.LastNameMat</td>
								<td class="py-3">@appt.DateAppointment.ToString("dd/MM/yyyy")</td>
								<td class="py-3">@appt.DateAppointment.ToString("hh:mm tt")</td>
								<td class="py-3">@appt.Specialty.NameSpecialty</td>
								<td class="py-3">
									<span class="badge fw-medium text-white px-2 py-1 @GetBadgeClass(appt.State)" style="min-width: 90px; text-align: center;">
										@GetStateText(appt.State)
									</span>
								</td>
								<td class="py-3">
									<div class="d-flex gap-2">
										<form method="post" asp-action="DownloadPDFAppointment" asp-controller="Doctor" class="m-0">
											<input type="hidden" name="id" value="@appt.IdAppointment" />
											<button type="submit" class="btn btn-sm fw-semibold d-flex align-items-center gap-2 px-3 py-2"
													style="background-color: #e53935; color: white; border-radius: 8px;"
													title="Descargar Cita PDF">
												<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
													<path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
													<path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
												</svg>
												Cita
											</button>
										</form>

										@if (appt.MedicalRecord != null)
										{
											<form method="post" asp-action="DownloadPDFMedicalRecord" asp-controller="Doctor" class="m-0">
												<input type="hidden" name="id" value="@appt.IdAppointment" />
												<button type="submit" class="btn btn-sm fw-semibold d-flex align-items-center gap-2 px-3 py-2"
														style="background-color: #1976d2; color: white; border-radius: 8px;"
														title="Descargar Registro Médico PDF">
													<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
														<path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
														<path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
													</svg>
													Historia
												</button>
											</form>
										}
									</div>
								</td>
							</tr>
						}
					</tbody>
				</table>

				@if (Model.Appointments.Count == 0)
				{
					<div class="text-center py-5">
						<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#94a3b8" class="mb-3" viewBox="0 0 16 16">
							<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
							<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
						</svg>
						<p class="text-muted fs-5 mb-0">No se encontraron citas para este paciente</p>
					</div>
				}

				<nav class="mt-5 mb-3">
					<ul class="pagination justify-content-center gap-2">
						<li class="page-item">
							<a class="page-link border-0 rounded-3 shadow-sm @(Model.CurrentPage == 1 ? "disabled bg-light text-muted" : "")"
							   asp-action="Profile"
							   asp-route-page="@(Model.CurrentPage - 1)"
							   asp-route-searchPatient="@ViewBag.SearchPatient"
							   style="@(Model.CurrentPage == 1 ? "" : "background: linear-gradient(to right, #2563eb, #06b6d4); color: white;") padding: 10px;">
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
									<path d="M15 18l-6-6 6-6" />
								</svg>
							</a>
						</li>

						@for (int i = 1; i <= Model.TotalPages; i++)
						{
							<li class="page-item">
								<a class="page-link border-0 rounded-3 shadow-sm fw-semibold"
								   asp-action="Profile"
								   asp-route-page="@i"
								   asp-route-searchPatient="@ViewBag.SearchPatient"
								   style="@(Model.CurrentPage == i ? "background: linear-gradient(to right, #2563eb, #06b6d4); color: white;" : "background: white; color: #2563eb;") padding: 10px; text-align: center;">
									@i
								</a>
							</li>
						}

						<li class="page-item">
							<a class="page-link border-0 rounded-3 shadow-sm @(Model.CurrentPage == Model.TotalPages ? "disabled bg-light text-muted" : "")"
							   asp-action="Profile"
							   asp-route-page="@(Model.CurrentPage + 1)"
							   asp-route-searchPatient="@ViewBag.SearchPatient"
							   style="@(Model.CurrentPage == Model.TotalPages ? "" : "background: linear-gradient(to right, #2563eb, #06b6d4); color: white;") padding: 10px; ">
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
									<path d="M9 18l6-6-6-6" />
								</svg>
							</a>
						</li>
					</ul>
				</nav>
			</div>
		</section>

	</div>
}
<script>
	// Cambiar 'profileImage' por 'file'
	document.getElementById('profileImage')?.addEventListener('change', function(e) {
		const file = e.target.files[0];
		if (file) {
			const reader = new FileReader();
			reader.onload = function(e) {
				document.getElementById('profileImagePreview').src = e.target.result;
			}
			reader.readAsDataURL(file);
		}
	});

	function submitProfileForm() {
		const form = document.getElementById('editProfileForm');
		const formData = new FormData(form);

		// Debug
		console.log('Datos enviados:');
		for (let pair of formData.entries()) {
			console.log(pair[0] + ': ', pair[1]);
		}

		const newPassword = document.getElementById('newPassword').value;
		const confirmPassword = document.getElementById('confirmPassword').value;

		if (newPassword && newPassword !== confirmPassword) {
			Swal.fire({
				icon: 'error',
				title: 'Error',
				text: 'Las contraseñas no coinciden'
			});
			return;
		}

		Swal.fire({
			title: 'Actualizando...',
			text: 'Por favor espere',
			allowOutsideClick: false,
			didOpen: () => {
				Swal.showLoading();
			}
		});

		fetch(form.action, {
			method: 'POST',
			body: formData
		})
		.then(response => response.json())
		.then(data => {
			Swal.close();
			console.log('Respuesta:', data);

			if (data.success) {
				Swal.fire({
					icon: 'success',
					title: '¡Éxito!',
					text: data.message,
					confirmButtonColor: '#3b82f6'
				}).then(() => {
					location.reload();
				});
			} else {
				Swal.fire({
					icon: 'error',
					title: 'Error',
					text: data.message
				});
			}
		})
		.catch(error => {
			console.error('Error:', error);
			Swal.close();
			Swal.fire({
				icon: 'error',
				title: 'Error',
				text: 'Error al actualizar el perfil'
			});
		});
	}
</script>